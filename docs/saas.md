# Technical Specification: SuperDuperAI

Данный документ описывает технические требования, стек технологий и архитектуру проекта SuperDuperAI - платформы для генерации видео с помощью AI.

## 1. Цели проекта

- Разработать высокопроизводительную платформу для генерации видео с AI
- Предоставить пользователям полный цикл функционала: от регистрации до подписок и создания видео
- Обеспечить многоязычность и SEO-оптимизацию для лендинга и публичных страниц
- Реализовать безопасную систему аутентификации и авторизации через Auth0
- Внедрить систему подписок и биллинга через Stripe
- Спроектировать масштабируемую архитектуру для работы с ML-моделями

## 2. Технологический стек

- **Фреймворк:** @Next.js (v14+ с App Router) - Fast by default, с оптимизированной конфигурацией для производительности
- **Язык:** @TypeScript - Статический типизатор для end-to-end типобезопасности
- **Аутентификация:** @NextAuth.js с Auth0 провайдером - Аутентификация для Next.js
- **База данных:** 
  - @PostgreSQL - Самая продвинутая открытая СУБД
  - @Prisma - ORM нового поколения для Node.js и TypeScript (для управления схемой)
  - @Kysely - Типобезопасный SQL-конструктор для TypeScript (для запросов)
- **Стейт-менеджмент:** @Zustand - Маленький, быстрый и масштабируемый менеджер состояний для React
- **UI-библиотека:** 
  - @shadcn/ui - Переиспользуемые компоненты на основе Radix UI и Tailwind CSS
- **Стилизация:** @Tailwind CSS v4.x - Utility-first CSS фреймворк для быстрой разработки UI
- **Платежи:** 
  - @Stripe - Платежная система для интернет-бизнеса
- **Email:** 
  - @React-email - React-рендерер для создания красивых писем
  - @Resend - Платформа для email-маркетинга для разработчиков
- **API:** @tRPC - End-to-end типобезопасные API endpoints
- **Управление окружением:** @T3 Env - Управление переменными окружения
- **Data-fetching:** @TanStack Query - Инструменты для управления состоянием, роутинга, визуализации данных
- **Анимации:** @Framer Motion - Библиотека анимаций для React
- **Иконки:** @Lucide - Красивые, простые, пиксельно-совершенные иконки
- **Шрифты:** @next/font - Оптимизация шрифтов без внешних запросов
- **Интернационализация:** @next-intl - Поддержка интернационализации
- **Менеджер пакетов:** @pnpm - Альтернатива npm для более быстрого и надежного управления пакетами
- **Монорепозиторий:** Структура на основе @Turborepo - Монорепозиторий для лучшего управления кодом
- **Линтинг/Форматирование:** 
  - @ESLint - Плагин для проверки кода Next.js и TypeScript
  - @Prettier - Форматирование кода для единого стиля
  - @Husky - Git hooks для автоматизации процессов
- **Аналитика и производительность:** 
  - @Posthog - Продуктовая аналитика для разработчиков
  - @Vercel Analytics - Метрики производительности для Next.js в реальном времени

## 3. Реальная структура проекта

Наш проект SuperDuperAI организован как монорепозиторий с использованием Turborepo. Ниже представлена актуальная структура проекта:

```
SuperDuperAI/                # Корневая директория проекта
├── .github/                 # GitHub Actions и конфигурации
│   └── workflows/           # CI/CD конфигурации
├── apps/                    # Приложения
│   ├── auth-proxy/          # Прокси для аутентификации
│   │   └── routes/          # Роуты для прокси
│   │
│   └── nextjs/              # Основное Next.js приложение
│       ├── public/          # Статические файлы
│       │   └── images/      # Изображения
│       │       ├── avatars/ # Аватары пользователей
│       │       └── blog/    # Изображения для блога
│       │
│       └── src/             # Исходный код
│           ├── app/         # App Router (Next.js 14+)
│           │   ├── [lang]/  # Локализованные роуты
│           │   │   ├── (auth)/       # Группа для аутентификации
│           │   │   │   ├── login/    # Страница входа
│           │   │   │   └── register/ # Страница регистрации
│           │   │   │
│           │   │   ├── (dashboard)/  # Группа для дашборда
│           │   │   │   └── dashboard/  # Дашборд пользователя
│           │   │   │       ├── billing/  # Управление подпиской
│           │   │   │       └── settings/ # Настройки пользователя
│           │   │   │
│           │   │   ├── (docs)/      # Группа для документации
│           │   │   │   └── docs/    # Документация
│           │   │   │
│           │   │   ├── (editor)/    # Группа для редактора
│           │   │   │   └── editor/  # Редактор видео
│           │   │   │       └── cluster/  # Управление кластерами
│           │   │   │
│           │   │   └── (marketing)/ # Группа для маркетинга
│           │   │       ├── blog/    # Блог
│           │   │       ├── pricing/ # Страница с ценами
│           │   │       └── page.tsx # Главная страница (лендинг)
│           │   │
│           │   ├── admin/           # Административная панель
│           │   │   ├── (dashboard)/ # Дашборд администратора
│           │   │   └── login/       # Вход для администратора
│           │   │
│           │   └── api/             # API роуты
│           │       ├── auth/        # Аутентификация
│           │       ├── trpc/        # tRPC эндпоинты
│           │       └── webhooks/    # Вебхуки (Stripe и др.)
│           │
│           ├── components/          # Компоненты React
│           │   ├── blog/            # Компоненты блога
│           │   ├── content/         # Компоненты для контента
│           │   ├── docs/            # Компоненты документации
│           │   ├── k8s/             # Компоненты для Kubernetes
│           │   ├── price/           # Компоненты для страницы цен
│           │   ├── feature-highlights.tsx # Карточки возможностей
│           │   ├── final-cta.tsx         # Призыв к действию
│           │   ├── how-it-works.tsx      # Как работает сервис
│           │   ├── testimonials.tsx      # Отзывы пользователей
│           │   ├── use-cases.tsx         # Сценарии использования
│           │   ├── video-scroll.tsx      # Скролл видео
│           │   └── [другие компоненты]   # UI компоненты
│           │
│           ├── config/              # Конфигурации
│           │   ├── dictionaries/    # Словари для локализации
│           │   ├── price/           # Конфигурация цен
│           │   └── ui/              # Конфигурация UI
│           │
│           ├── content/             # Контент (MDX)
│           │   ├── authors/         # Информация об авторах
│           │   ├── blog/            # Статьи блога
│           │   ├── docs/            # Документация
│           │   └── guides/          # Руководства
│           │
│           ├── hooks/               # React хуки
│           ├── lib/                 # Утилиты и библиотеки
│           │   └── validations/     # Валидации форм
│           │
│           ├── styles/              # Стили
│           │   ├── fonts/           # Шрифты
│           │   └── theme/           # Темы оформления
│           │
│           ├── trpc/                # tRPC конфигурация
│           ├── types/               # TypeScript типы
│           └── utils/               # Вспомогательные функции
│
├── docs/                    # Документация проекта
│   ├── tasks/               # Задачи канбан-системы
│   │   ├── backlog/         # Задачи в бэклоге
│   │   ├── in-progress/     # Задачи в работе
│   │   └── done/            # Выполненные задачи
│   │
│   ├── frontend-tech.md     # Документация по фронтенду
│   ├── marketing.md         # Маркетинговые требования
│   └── project_status.md    # Статус проекта
│
├── packages/                # Переиспользуемые пакеты
│   ├── api/                 # API-клиент
│   │   └── src/             # Исходный код API
│   │       └── router/      # tRPC роутеры
│   │
│   ├── auth/                # Аутентификация
│   ├── common/              # Общие утилиты
│   │   └── src/             
│   │       ├── config/      # Конфигурации
│   │       └── emails/      # Шаблоны email
│   │
│   ├── db/                  # База данных
│   │   └── prisma/          # Prisma схема
│   │
│   ├── stripe/              # Интеграция со Stripe
│   │   └── src/             # Исходный код для Stripe
│   │
│   └── ui/                  # UI компоненты (библиотека)
│       └── src/             # Исходный код компонентов
│           ├── data/        # Данные для компонентов
│           └── utils/       # Утилиты для компонентов
│
└── tooling/                 # Инструменты разработки
    ├── eslint-config/       # ESLint конфигурация
    ├── prettier-config/     # Prettier конфигурация
    ├── tailwind-config/     # Tailwind CSS конфигурация
    └── typescript-config/   # TypeScript конфигурация
```

## 4. Описание ключевых компонентов

### Модули Next.js приложения

#### 1. Компоненты лендинга (Marketing)

Компоненты, используемые на главной странице лендинга:

- **feature-highlights.tsx**: Карточки с основными возможностями платформы, отображающие ключевые преимущества SuperDuperAI.
- **how-it-works.tsx**: Пошаговая демонстрация процесса работы с платформой в 3 простых шага.
- **use-cases.tsx**: Карточки с различными сценариями использования для создателей контента, бизнеса, музыкантов и команд.
- **testimonials.tsx**: Отзывы пользователей с аватарами и рейтингами.
- **final-cta.tsx**: Призыв к действию в конце страницы с кнопкой регистрации.
- **video-scroll.tsx**: Интерактивный компонент для демонстрации видео при скролле.
- **rightside-marketing.tsx**: Правая часть главной страницы с демонстрацией возможностей.

#### 2. Компоненты аутентификации (Auth)

Компоненты для регистрации и авторизации:

- **user-auth-form.tsx**: Форма авторизации с поддержкой входа через почту и OAuth провайдеры.
- **user-avatar.tsx**: Компонент для отображения аватара пользователя.
- **user-name-form.tsx**: Форма редактирования имени пользователя.
- **sign-in-modal.tsx**: Модальное окно для входа в систему.

#### 3. Компоненты дашборда (Dashboard)

Компоненты для авторизованных пользователей:

- **billing-form.tsx**: Форма управления подпиской и биллингом.
- **user-account-nav.tsx**: Навигация по аккаунту пользователя.
- **shell.tsx**: Оболочка для страниц дашборда с общим лэйаутом.

#### 4. UI компоненты

Переиспользуемые UI компоненты:

- **card.tsx**: Базовый компонент карточки.
- **button.tsx**: Стилизованные кнопки с различными вариантами.
- **navbar.tsx**: Навигационная панель сайта.
- **modal.tsx**: Базовый компонент модального окна.
- **mode-toggle.tsx**: Переключатель между темной и светлой темой.

### Структура пакетов (packages)

#### 1. API пакет (@saasfly/api)

Содержит tRPC роутеры и процедуры для типобезопасного общения между клиентом и сервером.

#### 2. Auth пакет (@saasfly/auth)

Содержит логику аутентификации и авторизации, интегрированную с NextAuth.js.

#### 3. DB пакет (@saasfly/db)

Содержит:
- Prisma схему базы данных
- Миграции
- Типы и модели данных
- Адаптеры для работы с базой данных через Kysely

#### 4. UI пакет (@saasfly/ui)

Содержит переиспользуемые UI компоненты, которые могут быть использованы в различных приложениях:
- **accordion.tsx**: Компонент аккордеона.
- **alert-dialog.tsx**: Диалоговое окно предупреждения.
- **animated-tooltip.tsx**: Анимированные тултипы.
- **background-lines.tsx**: Декоративные линии фона.
- **colorful-text.tsx**: Текст с градиентным оформлением.
- **container-scroll-animation.tsx**: Анимация при скролле.
- **infinite-moving-cards.tsx**: Бесконечно движущиеся карточки.
- **и более 40 других компонентов**: Полный набор UI компонентов для создания пользовательского интерфейса.

#### 5. Stripe пакет (@saasfly/stripe)

Содержит логику работы с платежами через Stripe:
- Обработчики вебхуков
- Создание и управление подписками
- Интеграция с корзиной покупок

#### 6. Common пакет (@saasfly/common)

Содержит общие утилиты и функции, используемые в разных частях приложения:
- **config**: Общие конфигурации
- **emails**: Шаблоны email на React Email

### Структура директорий Next.js приложения

#### 1. App Directory (app/)

Использует новую систему роутинга Next.js App Router:

- **[lang]**: Роуты с поддержкой различных языков
  - **(auth)**: Группа роутов для аутентификации
  - **(dashboard)**: Группа роутов для авторизованных пользователей
  - **(marketing)**: Группа роутов для маркетинговых страниц
  - **(docs)**: Группа роутов для документации
  - **(editor)**: Группа роутов для редактирования видео

#### 2. API роуты (app/api)

- **auth**: Эндпоинты для аутентификации через NextAuth.js
- **trpc**: tRPC API эндпоинты
- **webhooks**: Вебхуки для интеграций (Stripe и др.)

#### 3. Контент (content/)

Содержит MDX файлы для:
- Блога
- Документации
- Руководства пользователя
- Информации об авторах

#### 4. Конфигурации (config/)

- **dictionaries**: Словари для перевода интерфейса
- **price**: Конфигурация тарифных планов
- **ui**: Настройки UI компонентов

## 5. Фичи и возможности

### 1. AI видео генерация

- Создание видео по текстовому описанию
- Настройка персонажей с помощью LoRA технологии
- Множество стилей и визуальных эффектов
- Управление камерой и движением

### 2. Многоязычность

- Поддержка нескольких языков интерфейса
- Локализованные URL (например, /en/dashboard, /ru/dashboard)
- Автоматическое определение языка пользователя
- Словари для каждого языка в JSON формате

### 3. Аутентификация

- Вход через email/пароль
- Вход через социальные сети (Google, GitHub)
- JWT токены для сессий
- Защищенные роуты для авторизованных пользователей

### 4. Подписки и биллинг

- Интеграция со Stripe
- Несколько тарифных планов
- Пробный период
- Управление подпиской из личного кабинета

### 5. Пользовательский интерфейс

- Современный дизайн с Tailwind CSS
- Адаптивность для всех устройств
- Темная и светлая тема
- Анимации и интерактивные элементы

## 6. Команды разработки

```bash
# Установка зависимостей
pnpm install

# Запуск dev сервера
pnpm dev

# Запуск только веб-приложения
pnpm dev:web

# Проверка типов
pnpm typecheck

# Линтинг
pnpm lint

# Исправление линтинг-ошибок
pnpm lint:fix

# Форматирование кода
pnpm format:fix

# Сборка проекта
pnpm build

# Обновление схемы базы данных
pnpm db:push

# Генерация нового компонента
pnpm gen
```

## 7. Нефункциональные требования

### Производительность

- Core Web Vitals в "зеленой зоне"
- Оптимизация изображений и видео
- Эффективная загрузка ресурсов
- Кэширование данных на клиенте и сервере

### Безопасность

- HTTPS для всех запросов
- Защита от CSRF атак
- Проверка данных на сервере
- Безопасное хранение секретов

### Масштабируемость

- Горизонтальное масштабирование сервисов
- Оптимизация работы с ML моделями
- Эффективное хранение и доставка видео
- Кэширование тяжелых вычислений

### Доступность (A11Y)

- Семантическая разметка HTML
- Поддержка скринридеров
- Достаточный контраст цветов
- Навигация с клавиатуры

## 8. Процесс разработки и деплоймента

### CI/CD

- GitHub Actions для автоматизации
- Автоматические тесты при пуше
- Деплоймент на Vercel
- Превью для Pull Request'ов

### Мониторинг и логирование

- Sentry для отслеживания ошибок
- Vercel Analytics для мониторинга производительности
- Posthog для аналитики пользователей
- Структурированные логи

### Управление задачами

- Канбан-система в docs/tasks/
- Четкий жизненный цикл задач
- Документирование выполненных работ
- Актуализация статуса проекта


