# Интеграция Google Tag Manager

## Описание задачи

Интегрировать Google Tag Manager (GTM) в проект Next.js 15.3 с использованием оптимизированного компонента из `@next/third-parties`. Реализовать возможность отключения GTM в режиме разработки для предотвращения ненужного отслеживания во время локальной разработки.

## Реализация

### Используемые технологии

- Next.js 15.3.1
- @next/third-parties 15.3.1
- React 19.1.0

### Файлы компонентов

1. **src/components/ui/google-tag-manager.tsx**
   - Компонент для интеграции Google Tag Manager
   - Поддерживает пропсы:
     - `gtmId` - возможность переопределения ID тега
     - `skipInDevelopment` - флаг для отключения в режиме разработки

2. **src/components/ui/analytics-providers.tsx**
   - Агрегирующий компонент для всех аналитических сервисов
   - Принимает параметры для настройки аналитики во всем приложении

3. **src/app/layout.tsx**
   - Корневой лейаут, куда добавлен `<AnalyticsProviders />`

### Управление средой разработки

Компонент умеет определять режим работы (разработка/продакшн) с помощью проверки `process.env.NODE_ENV === 'development'` и по умолчанию отключает загрузку GTM в режиме разработки.

Для включения GTM в режиме разработки:
```tsx
<AnalyticsProviders skipInDevelopment={false} />
```

### Переменные окружения

Для работы GTM требуется настройка переменной окружения:

```
NEXT_PUBLIC_GOOGLE_TAG_MANAGER_ID=GTM-XXXXXXX
```

Это можно сделать в файле `.env.local` (не включается в систему контроля версий) или через переменные окружения на сервере развертывания.

## Логика работы

1. В режиме разработки (`NODE_ENV === 'development'`):
   - GTM не загружается по умолчанию
   - В консоли появляется информационное сообщение
   - Можно принудительно включить через параметр компонента

2. В производственном режиме (`NODE_ENV === 'production'`):
   - GTM всегда загружается, если указан корректный ID
   - Если ID не указан, скрипт не будет загружен

## Преимущества решения

1. Использование `@next/third-parties` вместо ручного добавления скрипта через `next/script` дает оптимизированную загрузку
2. Предотвращение ненужного отслеживания в режиме разработки
3. Гибкая настройка через переменные окружения
4. Код аналитики изолирован в отдельных компонентах для лучшей поддержки
5. Соответствует рекомендациям Next.js 15.3 по интеграции сторонних сервисов 