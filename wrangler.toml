# Конфигурация Cloudflare Pages для проекта на Next.js 15

name = "landing"
main = "./.vercel/output/functions/index.func/index.js"
compatibility_date = "2023-12-01"
compatibility_flags = ["nodejs_compat", "NO_RESPONSE_COMPRESSION"]
workers_dev = true

# Указываем директорию для Pages деплоя - это критично для Cloudflare Pages
pages_build_output_dir = ".vercel/output/static"

# Настройки для предотвращения ошибок с eval
[build]
command = "pnpm build"

# Добавляем переменные окружения для обхода ограничений CSP
[vars]
NEXT_SKIP_CSP = "1"
NEXT_DISABLE_COMPRESSION = "1"

# Настройки для обработки маршрутов
[[routes]]
pattern = ".*"
script = "landing"

# Используем дополнительные настройки безопасности
[security]
unsafe_eval = true  # Разрешаем eval для Next.js RSC

# Настройки кэширования
[site]
bucket = ".vercel/output/static"

# Настройки для ассетов
[assets]
directory = ".vercel/output/static"
binding = "ASSETS" 

[observability.logs]
enabled = true